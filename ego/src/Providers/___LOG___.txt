
      SELECT
        *,
        (SELECT price
          FROM oc_product_special
          WHERE product_id = a.product_id
            AND customer_group_id = 1
            AND (date_start = '0000-00-00' OR date_start < NOW())
            AND (date_end = '0000-00-00' OR date_end > NOW())
          ORDER BY priority ASC, price ASC LIMIT 1) AS special,
        IF(image = '',
          COALESCE(
            (SELECT image FROM oc_product_image
              WHERE product_id = a.product_id ORDER BY sort_order LIMIT 1),
            'placeholder.jpg'
          ), image) AS image,
        (SELECT COUNT(1) AS cnt FROM oc_customer_wishlist
          WHERE customer_id = 0 AND product_id = a.product_id) > 0 AS is_wishlist,
        quantityStore1 + quantityStore2 AS quantity
      FROM (
        SELECT
            p.product_id,
            po.name,
            p.image,
            p.price,
            p.minimum,
            po.quantity AS quantityStore1,
            0 AS quantityStore2,
            1 as is_owner,
            pop.price_min,
            pop.price_max,
            p.sort_order
           FROM oc_category_path cp
        LEFT JOIN oc_product_to_category p2c ON cp.category_id = p2c.category_id
        LEFT JOIN oc_product p ON p2c.product_id = p.product_id
        INNER JOIN product_owner po ON po.product_id_default = p.product_id
      LEFT JOIN oc_product_description pd ON p.product_id = pd.product_id
      LEFT JOIN product_owner_prices pop ON pop.product_owner_id = po.id
            AND pop.customer_group_id = 1
      WHERE pd.language_id = 2
        AND p.status = 1
     AND cp.path_id = 10000010 GROUP BY p.product_id

        UNION ALL

        SELECT
            p.product_id,
            pd.name,
            p.image,
            COALESCE((SELECT price FROM oc_product_discount
                WHERE product_id = p.product_id AND customer_group_id = 1
                ORDER BY priority ASC, price ASC LIMIT 1),
              p.price) AS price,
            p.minimum,
            p.quantity AS quantityStore1,
            p.quantity_store_2,
            0 AS is_owner,
            price AS price_min,
            price AS price_max,
            p.sort_order
           FROM oc_category_path cp
      LEFT JOIN oc_product_to_category p2c ON cp.category_id = p2c.category_id
      LEFT JOIN oc_product p ON p2c.product_id = p.product_id
      LEFT JOIN oc_product_description pd ON p.product_id = pd.product_id
      WHERE pd.language_id = 2
        AND p.status = 1
     AND cp.path_id = 10000010 GROUP BY p.product_id

        ORDER BY is_owner DESC, sort_order ASC, name
      ) a
      ORDER BY is_owner DESC, sort_order ASC, name
      LIMIT 0,15
