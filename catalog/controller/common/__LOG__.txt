
      SELECT
        aa.*,
        CONCAT(cp.path_id, '_', aa.category_id) AS path,
        cd.name AS categoryName0,
        IF(aa.image0 = '',
        COALESCE(
          (SELECT image FROM oc_product_image
            WHERE product_id = aa.product_id ORDER BY sort_order ASC LIMIT 1),
          'placeholder.png'
        ), aa.image0) AS image
      FROM (
        SELECT * FROM (
          SELECT
            cd.category_id,
            cd.name AS categoryName,
            p.product_id,
            pd.name AS productName,
            p.image AS image0,
            0.00 AS price,
            0 AS quantity,
            true AS isOwner,
            pop.price_min AS priceMin,
            pop.price_max AS priceMax
          FROM product_owner pd
            LEFT JOIN product_owner_prices pop ON pop.product_owner_id = pd.id
            LEFT JOIN oc_product p ON p.product_id = pd.product_id_default
            LEFT JOIN oc_product_to_category ptc ON ptc.product_id = p.product_id
            LEFT JOIN oc_category_path cp ON cp.category_id = ptc.category_id
            LEFT JOIN oc_category_description cd ON cd.category_id = cp.path_id
          WHERE cp.level = 1
            AND cd.language_id = 2
            AND pop.customer_group_id = 1
            AND pd.name LIKE '%j730%'

          UNION ALL

          SELECT
            cd.category_id,
            cd.name AS categoryName,
            pd.product_id,
            pd.name AS productName,
            p.image AS image0,
            COALESCE(pdc.price, p.price) AS price,
            (SELECT SUM(pts.quantity) FROM oc_product_to_stock pts WHERE pts.product_id = p.product_id) +
              p.quantity AS quantity,
            false AS isOwner,
            0.00 AS priceMin,
            0.00 AS priceMax
          FROM oc_product p
            LEFT JOIN oc_product_description pd ON pd.product_id = p.product_id
            LEFT JOIN oc_product_to_category ptc ON ptc.product_id = p.product_id
            LEFT JOIN oc_category_path cp ON cp.category_id = ptc.category_id
            LEFT JOIN oc_category_description cd ON cd.category_id = cp.path_id
            LEFT JOIN oc_product_discount AS pdc ON pdc.product_id = p.product_id
              AND pdc.customer_group_id = 1
          WHERE p.status = 1
            AND pd.language_id = 2
            AND cd.language_id = 2
            AND cp.level = 1 AND pd.name LIKE '%j730%'
          ORDER BY isOwner DESC, quantity DESC
          ) aa
        GROUP BY categoryName
        ORDER BY isOwner DESC, quantity DESC
      ) aa
      LEFT JOIN oc_category_path cp ON cp.category_id = aa.category_id
      LEFT JOIN oc_category_description cd ON cd.category_id = cp.path_id
      WHERE cp.level = 0 AND cd.language_id = 2
      GROUP BY product_id
      ORDER BY isOwner DESC, quantity DESC
      LIMIT 10
    