const siteLoader = document.getElementById('siteLoader');

const showSiteLoader = () => {
  siteLoader.classList.remove('hide');
  document.body.classList.add('body-site-loader');
}

const hideSiteLoader = () => {
  siteLoader.classList.add('hide');
  document.body.classList.remove('body-site-loader');
}

window.addEventListener('load', () => {
  const downloadPriceList = document.querySelector('.download-price-list a');

  const getFileName = (contentDisposition = '') => {
    const filenameMatch = contentDisposition.match(/filename[^;\n=]*=((['"])(.*)?\2|[^;\n]*)/);
    return (filenameMatch && filenameMatch[3]) || 'price-list.xls';
  }

  const onClick = async event => {
    event.preventDefault();
    const wrapperPreloader = document.querySelector('.wrapper-preloader');
    wrapperPreloader.classList.add('preloader-appear');
    const response = await fetch('/price-list');
    const blob = await response.blob();

    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = getFileName(response.headers.get('content-disposition'));
    document.body.appendChild(a);
    a.click();
    a.remove();
    wrapperPreloader.classList.remove('preloader-appear');
  };

  downloadPriceList.addEventListener('click', onClick);

  hideSiteLoader();
});
